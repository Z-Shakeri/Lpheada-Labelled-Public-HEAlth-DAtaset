---
title: "Explore"
output:
  pdf_document: default
  html_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r cars}
library(us2020election)
setwd("Path to your Dataset")

library(tidyverse)
library(reticulate)
library(ggthemes)
#To use python
library(reticulate)
library(ggridges)
theme_set(theme_tufte())
theme_update(legend.position = 'none',
             text = element_text(family = 'Lobser'),
             plot.title = element_text(margin = margin(t= 10,b= 5),family = 'Lobser'),
             plot.subtitle = element_text(margin = margin(b= 10),family = 'Lobser'),
             panel.background = element_rect(fill = '#FDF6E3'),
             plot.background = element_rect(fill = '#FDF6E3'))
```


```{r cars}
library(reticulate)
use_python("Python path on your system")
viz = read.csv('SQ-Score.csv')
```



```{python}
# To install this package with conda run one of the following:
# conda install -c conda-forge textstat
# conda install -c conda-forge/label/cf202003 textstat
import numpy as np
import pandas as pd 
import textstat
```


```{r}
library(kableExtra)
library(tidyverse)
library(googlesheets4)
library(tidymodels)
library(gghighlight)
library(hrbrthemes)
library(ggthemes)
library(ggrepel)
library(ggalt)
library(extrafont)
library(ggtext)
library(ggforce)
library(cowplot)
```

```{r}
countries <-
  c('Canada','Australia', 'United states', 'United Kingdom')
```

```{python}
r.viz.columns
r.viz.dtypes

```

```{r}
order <- c( 'g', 'ar','f', 'c', 'l', 'd',  'gs','t','sc')

viz_scaled <- viz %>%
  mutate_at(order, scales::rescale, to = c(3, 20)) %>%
  filter(country %in% countries) %>%
  # filter(!is.na()) %>%
  mutate(country = factor(country))  %>%
  pivot_longer(
    names_to = 'metric',
    cols = c( 'g', 'ar','f', 'c', 'l', 'd', 'gs', 't', 'sc'),
    values_to = 'value') 


library(showtext)
font_add("Arial", "/System/Library/Fonts/Supplemental/Arial.ttf")  # Use the actual file path
showtext_auto()
```


```{r}
viz_scaled
```




```{r}
viz_scaled= viz_scaled[complete.cases(viz_scaled), ]
```


```{r}
ggplot() +
  ### This plots the average of each audio feature
  geom_polygon(
    data = viz_scaled %>%  group_by(country, metric) %>%
      filter(!is.na(metric)) %>%
      filter(!is.na(value)) %>%
      summarise_at(c("value"),mean) %>%
      arrange(factor(metric, levels = order)) %>%
      ungroup(),
    aes(x = metric, y = value, group = country,),
    alpha = .35,
    size = .5,
    show.legend = T,
    fill = "#b51038"
  ) +
  ### This plots the maximum of each audio feature
  geom_polygon(
    data = viz_scaled %>%  group_by(country, metric) %>%
      summarise_at(c("value"), max) %>%
      arrange(factor(metric, levels = order)) %>%
      ungroup(),
    aes(x = metric, y = value, group = country,),
    alpha = .15,
    size = .5,
    show.legend = T,
    fill = "#b51038"
  ) +
  ### This plots the mimumn of each audio feature
  
  geom_polygon(
    data = viz_scaled %>%  group_by(country, metric) %>%
      summarise_at(c("value"), min) %>%
      arrange(factor(metric, levels = order)) %>%
      ungroup(),
    aes(x = metric, y = value, group = country,),
    alpha = 1,
    size = .5,
    show.legend = T,
    fill =  "#b51038"
    #"#b51038"
  ) +
  scale_x_discrete(
    limits = order,
    labels = c(
       ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '
    )
  ) +
  coord_polar(clip = 'off') +
  theme_minimal() +
  labs(title = "Lexical and Linguistic characteristics of tweets per country",
       caption = 'Source: Spotify \n Visualization: mcnakhaee') +
  ylim(0, 20.5) +
  facet_wrap( ~ country, ncol = 4) +
  theme(
    axis.title = element_blank(),
    axis.ticks = element_blank(),
    axis.text.y = element_blank(),
    axis.text.x = element_text(
      family =  'Montserrat',
      size = 8.5,
      margin = ggplot2::margin(30, 0, 20, 0)
    ),
    plot.caption = element_text(
      family = 'Montserrat',
      margin = ggplot2::margin(30, 0, 20, 0),
      size = 11,
      color = 'grey80'
    ) ,
    text = element_text(family =  'Montserrat'),
    strip.text = element_text(family =  'Montserrat', size = 18),
    strip.text.x = element_text(margin = ggplot2::margin(1, 1, 1, 1, "cm")),
    panel.spacing = unit(3.5, "lines"),
    panel.grid = element_blank(),
    plot.title = element_text(
      family = 'Montserrat',
      hjust = .5,
      margin = ggplot2::margin(30, 0, 20, 0),
      size = 32,
      color = 'gray10'
    )
  )
ggsave("SQScores.pdf", width=15)
```



```{r}
create_plot <- function(metric = Flesch_Reading_Ease_formula,subtitle = subtitle) {
  metrics <- rlang::enquo(metric)
  df %>%
    separate_rows(country, sep = ',') %>%
    filter(country %in% countries, target != 'NotSB') %>%
    add_count(country) %>%
    ggplot() +
    geom_density_ridges(aes(
      x = !!metrics ,
      y = country,
      fill = country
    )) +
    labs(x = '', y = '',title = "How Easy Is It to Comprehend Different US Politicians?",subtitle = str_wrap(subtitle,width = 100)) +
    scale_fill_manual(values = custom_palette) 
  
}
```

```{r}
library(showtext)
font_add("Arial", "/System/Library/Fonts/Supplemental/Arial.ttf")  # Use the actual file path
showtext_auto()
create_plot(grammar_score,subtitle = 'The Flesch Reading Ease scores measure')

```



```{r}
df %>%
  filter(country %in% countries) %>%
  mutate(text_standard = str_replace(text_standard,' and ','-'),
        text_standard = factor(
    text_standard,
    levels = c(
      '4th-5th grade',
      '5th-6th grade',
      '6th-7th grade',
      '7th-8th grade',
      '8th-9th grade',
      '9th-10th grade',
      '10th-11th grade',
      '11th-12th grade',
      '12th-13th grade',
      '14th-15th grade'
    )
  )) %>%
  count(country, text_standard) %>%
  mutate(n = n + 1) %>%
  ggplot()  +
  geom_col(aes(x = text_standard , y =  n, fill = country)) +
  labs(x = '', y = 'Number of Speeches', title = "How Easy Is It to Understand 'Trump's Speeches?",
       subtitle = 'Based on several readability tests, the education level that one needs to comprehend the 2020 Election speeches by different US politicians is illustrated in this plot.' ) +
  scale_fill_manual(values = custom_palette) +
  scale_y_log10() +
  facet_wrap(~ country, ncol = 1) +
  theme(axis.text  = element_text(size = 13),
        axis.title.y = element_text(size = 15,margin = margin(r = 10,l = 10)),
        plot.title = element_text(size = 20,margin = margin(b = 10,t = 10)),
        plot.subtitle = element_text(size = 14,margin = margin(b = 10)),
        strip.text = element_text(size = 15))
```
